<?xml version="1.0"?>
<?xml-stylesheet href="modification.xsl" type="text/xsl"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

	ATTENTION: If you are trying to install this manually, you should try
	the package manager.  If it will not work for you, please take a look
	at the following for information on this format:
		http://mods.simplemachines.org/docs/manual-install.php

================================================================================

	Modification files can be used to modify files so that they do what
	your package needs them to do to work properly.

 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->

<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<!-- This information needs to be the same as that in the package-info.xml. -->
	<id>Niko:SMFWiki</id>
	<version>{version}</version>

	<!-- Board directory -->
	<file name="$boarddir/index.php">
		<operation>
			<search position="before"><![CDATA[		'im' => array('PersonalMessage.php', 'MessageMain'),]]></search>
			<add><![CDATA[
		'wiki' => array('Wiki.php', 'Wiki'),]]></add>
		</operation>
	</file>

	<!-- Source files -->
	<file name="$sourcedir/Admin.php">
		<operation>
			<search position="after"><![CDATA['current_theme' => array(]]></search>
			<add><![CDATA[
				'wiki' => array(
					'label' => $txt['admin_wiki'],
					'file' => 'WikiAdmin.php',
					'function' => 'WikiAdmin',
					'subsections' => array(
						'main' => array($txt['admin_wiki_main']),
						'settings' => array($txt['admin_wiki_settings']),
					),
				),
				]]></add>
		</operation>
	</file>

	<file name="$sourcedir/Subs.php">
		<operation>
			<search position="before"><![CDATA[	$context['allow_calendar'] = allowedTo('calendar_view') && !empty($modSettings['cal_enabled']);]]></search>
			<add><![CDATA[	$context['allow_wiki'] = !empty($modSettings['wikiEnabled']) && allowedTo('wiki_access');]]></add>
		</operation>

		<operation>
			<search position="after"><![CDATA[			'search' => array(]]></search>
			<add><![CDATA[			'wiki' => array(
				'title' => $txt['wiki'],
				'href' => $scripturl . '?action=wiki',
				'show' => $context['allow_wiki'] && empty($modSettings['wikiStandalone']),
				'sub_buttons' => array(),
			),]]></add>
		</operation>
	</file>

	<!-- Languages -->
	<file name="$languagedir/Modifications.english.php">
		<operation>
			<search position="end" />
			<add><![CDATA[
// SMF Wiki
$txt['wiki'] = 'Wiki';
$txt['admin_wiki'] = 'Wiki';
$txt['admin_wiki_main'] = 'Main';
$txt['admin_wiki_settings'] = 'Settings';
]]></add>
		</operation>
	</file>

</modification>